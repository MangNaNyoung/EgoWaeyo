<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- ê²Œì‹œíŒ ì¶”ê°€ ëª¨ë‹¬ -->
<div th:fragment="addProjectModal" class="modal fade"
	id="addProjectModal" tabindex="-1"
	aria-labelledby="addProjectModalLabel" aria-hidden="true">
	<div class="modal-dialog modal-lg"
		style="max-width: 970px; height: 850px; margin-top: 115px;">
		<div class="modal-content">
			<div class="modal-header">
				<h5 class="modal-title" id="addProjectModalLabel"></h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"
					aria-label="Close"></button>
			</div>
			<div class="modal-body">
				<form>
					<!-- ê²Œì‹œíŒ ìœ í˜• ì„ íƒ -->
					<div class="mb-5">
						<div class="form-check form-check-inline">
							<input class="form-check-input ms-1" type="radio"
								name="boardType" id="type1" checked
								onclick="toggleParentBoard(false)"> <label
								class="form-check-label ms-2" for="type1">ê²Œì‹œíŒ ì¶”ê°€</label>
						</div>
						<div class="form-check form-check-inline">
							<input class="form-check-input" type="radio" name="boardType"
								id="type2" onclick="toggleParentBoard(true)"> <label
								class="form-check-label" for="type2">í•˜ìœ„ ê²Œì‹œíŒ ì¶”ê°€</label>
						</div>
					</div>

					<!-- ìƒìœ„ê²Œì‹œíŒ ì„ íƒ -->
					<div class="mb-3 d-flex align-items-center">
						<label for="parentBoard" class="form-label me-2 ms-4">ìƒìœ„
							ê²Œì‹œíŒ</label> <select id="parentBoard" class="form-select ms-3"
							style="width: 250px;" disabled>
							<option value="">ìƒìœ„ ê²Œì‹œíŒì„ ì„ íƒí•˜ì„¸ìš”</option>
						</select>
					</div>

					<!-- ê²Œì‹œíŒëª… ì…ë ¥ -->
					<div class="mb-3 d-flex align-items-center">
						<label for="boardName" class="form-label me-2 ms-4">ê²Œì‹œíŒëª… <span
							class="text-danger">*</span></label> <input type="text" id="boardName"
							class="form-control ms-4" placeholder="ê²Œì‹œíŒëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
							style="width: 250px;">
					</div>

					<!-- ê²Œì‹œíŒ ì‚¬ìš©ì—¬ë¶€ ì„ íƒ -->
					<div class="mb-3">
						<label class="form-label d-block-inline ms-4">ì‚¬ìš© ì—¬ë¶€</label>
						<div class="form-check form-check-inline">
							<input class="form-check-input ms-1" type="radio" name="useAt"
								value="Y" id="use1" checked> <label
								class="form-check-label" for="use1">ì‚¬ìš©</label>
						</div>
						<div class="form-check form-check-inline ms-2">
							<input class="form-check-input" type="radio" name="useAt"
								value="N" id="use2"> <label class="form-check-label"
								for="use2">ë¯¸ì‚¬ìš©</label>
						</div>
					</div>

					<!-- ì‚¬ìš©ìë³„ ì„¤ì • -->
					<div class="modal-wrap position-relative ">
						<div class="d-flex align-items-center mb-2">
							<span class="setting-title">ê¶Œí•œì„¤ì •</span>
						</div>
						<div class="main-area">
							<!-- ì¢Œì¸¡ ì¡°ì§ íŠ¸ë¦¬ -->
							<div class="left-panel overflow-auto">
								<ul class="tree-list ">
									<p class="egowaeyo">Egowaeyo</p>

								</ul>
							</div>

							<!-- ì¤‘ì•™ ë¶€ì„œ/ì‚¬ì› ë¦¬ìŠ¤íŠ¸ -->
							<div class="center-panel overflow-auto">
								<div class="search-box">
									<input type="text" placeholder=""> <span
										class="search-icon"> <svg width="18" height="18"
											fill="none" stroke="#bbb" stroke-width="2"
											viewBox="0 0 24 24"> <circle cx="11" cy="11" r="7" />
                              <line x1="16" y1="16" x2="21" y2="21" /></svg>
									</span>
								</div>
								<div class="dept-list-wrap">
									<div class="dept-list-header">
										<label for="dept1" class="mb-0" style="font-weight: 500;"></label>
									</div>
									<ul class="dept-list" id="employeeSelect">

									</ul>
								</div>
							</div>

							<!-- ë²„íŠ¼ì„ dept-listì™€ right-panel ì‚¬ì´ì— ë°°ì¹˜ -->
							<div class="dept-btns">
								<div
									style="display: inline-flex; align-items: center; gap: 8px;">
									<button class="btn btn-sm" id="readButton">ì½ê¸°</button>
									<img class="arrow-icon"
										th:src="@{/assets/images/icon/arrowtwo.png}">
								</div>
								<div
									style="display: inline-flex; align-items: center; gap: 8px;">
									<button class="btn btn-sm" id="writeButton">ì“°ê¸°</button>
									<img class="arrow-icon"
										th:src="@{/assets/images/icon/arrowtwo.png}">
								</div>
								<div
									style="display: inline-flex; align-items: center; gap: 8px;">
									<button class="btn btn-sm" id="manageButton">ê´€ë¦¬</button>
									<img class="arrow-icon"
										th:src="@{/assets/images/icon/arrowtwo.png}">
								</div>
							</div>

							<div class="right-panel">
								<div class="right-box overflow-auto"></div>

								<div class="right-box overflow-auto"></div>

								<div class="right-box overflow-auto"></div>
							</div>
						</div>
					</div>
				</form>
			</div>
			<div class="modal-footer">
				<button id="saveButton" class="btn btn-primary">ì €ì¥</button>
				<button id="cancelButton" class="btn btn-secondary"
					data-bs-dismiss="modal">ì·¨ì†Œ</button>
			</div>
		</div>
	</div>

	<script>
	document.addEventListener("DOMContentLoaded", function () {
		 	const type1Radio = document.getElementById("type1");
		    const type2Radio = document.getElementById("type2");
		    const modalWrap = document.querySelector(".modal-wrap");
		    modalWrap.style.display = "none"; // ì´ˆê¸°ì—ëŠ” ì‚¬ìš©ìë³„ ì„¤ì • ìˆ¨ê¹€

		    
		  
		    // ê²Œì‹œíŒ ìœ í˜• ì„ íƒ ì‹œ ì´ë²¤íŠ¸ ì²˜ë¦¬
		    type1Radio.addEventListener("click", function () {
		        modalWrap.style.display = "none"; // ì‚¬ìš©ìë³„ ì„¤ì • ìˆ¨ê¸°ê¸°
		    });

		    type2Radio.addEventListener("click", function () {
		        modalWrap.style.display = "block"; // ì‚¬ìš©ìë³„ ì„¤ì • í‘œì‹œ
		    });
		    
		// parentBoard í™œì„±í™”/ë¹„í™œì„±í™” í•¨ìˆ˜
	    function toggleParentBoard(isEnabled) {
	        const parentBoardElement = document.getElementById("parentBoard");
	        if (parentBoardElement) {
	            parentBoardElement.disabled = !isEnabled; // disabled ì†ì„± ì œì–´
	        } else {
	            console.error("ìƒìœ„ ê²Œì‹œíŒ ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
	        }
	    }

	    // ì „ì—­ì—ì„œ ì ‘ê·¼ ê°€ëŠ¥í•˜ë„ë¡ í•¨ìˆ˜ ë“±ë¡
	    window.toggleParentBoard = toggleParentBoard;
   
	// ìƒìœ„ê²Œì‹œíŒ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
		fetch('/egowaeyo/bbsMaster/combbs')
		.then(response => {
			if (!response.ok) {
		    	throw new Error(`HTTP error! status: ${response.status}`);
		    }
		    return response.json();
		})
		.then(data => {
			console.log("Fetched Data:", data); // ë°ì´í„° í™•ì¸
		    const parentBoardSelect = document.getElementById("parentBoard");
		    parentBoardSelect.innerHTML = '<option value="">ìƒìœ„ ê²Œì‹œíŒì„ ì„ íƒí•˜ì„¸ìš”</option>'; // ê¸°ë³¸ ì˜µì…˜ ì¶”ê°€

		    data.forEach(item => {
		    	const option = document.createElement("option");
		        option.value = item.CODE;
		        option.textContent = item.CODE_NM; // ì •í™•í•œ í‚¤ ì´ë¦„ ì‚¬ìš©
		        parentBoardSelect.appendChild(option);
		    });
		 })
		 .catch(error => console.error('Error fetching combbs:', error));
   
   
   
   	//ë¶€ì„œ, ì‚¬ì› ë¶ˆëŸ¬ì˜¤ê¸°(ì‚¬ìš©ìë³„ ì„¤ì •)
   	const treeList = document.querySelector(".tree-list");
   	const deptList = document.querySelector(".dept-list");
   	const deptHeader = document.querySelector(".dept-list-header");
   	const searchBox = document.querySelector(".search-box input");
   	
   	let allUsers = []; // ëª¨ë“  ì‚¬ì› ë°ì´í„°ë¥¼ ì €ì¥
   	let selectedDepts = new Set(); // ì„ íƒëœ ë¶€ì„œ ëª©ë¡
   	let selectedUsers = new Set(); // ì„ íƒëœ ì‚¬ì› ëª©ë¡
   	let currentDeptUsers = []; // í˜„ì¬ ì„ íƒëœ ë¶€ì„œì˜ ì‚¬ì› ë°ì´í„°ë¥¼ ì €ì¥

	// ì„œë²„ì—ì„œ ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
	fetch('/egowaeyo/bbsMaster/selectDeptEmp')
	.then(response => {
		if (!response.ok) {
        	throw new Error(`HTTP error! status: ${response.status}`);
        }
        return response.json(); // JSON í˜•ì‹ìœ¼ë¡œ ë³€í™˜
    })
    .then(data => {
    	allUsers = data; // ëª¨ë“  ë°ì´í„°ë¥¼ ì €ì¥
        const uniqueOrgnztNm = [...new Set(data.map(item => item.orgnztNm))];

        // tree-list ì´ˆê¸°í™” ë° orgnztNm ì¶”ê°€
        uniqueOrgnztNm.forEach(orgnztNm => {
			const newLi = document.createElement("li");
           	newLi.textContent = orgnztNm;
            treeList.appendChild(newLi);
        });

        // tree-listì˜ í´ë¦­ ì´ë²¤íŠ¸ ìœ„ì„
        treeList.addEventListener("click", function (event) {
        	if (event.target.tagName === "LI") {
            	const selectedOrgnztNm = event.target.textContent.trim();
				
                // ì„ íƒ ìƒíƒœ í† ê¸€
                if (selectedDepts.has(selectedOrgnztNm)) {
                	selectedDepts.delete(selectedOrgnztNm);
                    event.target.style.backgroundColor = ""; // ì„ íƒ í•´ì œ
                } else {
                	selectedDepts.add(selectedOrgnztNm);
                    event.target.style.backgroundColor = "#f0f8ff"; // ì„ íƒ ì¶”ê°€
                }

                // ì„ íƒëœ ë¶€ì„œì˜ ì‚¬ì› í•„í„°ë§
                currentDeptUsers = allUsers.filter(emp => selectedDepts.has(emp.orgnztNm));
				// dept-list ì—…ë°ì´íŠ¸
                updateDeptList(currentDeptUsers);
				// ì²´í¬ë°•ìŠ¤ì™€ ë¼ë²¨ ì—…ë°ì´íŠ¸
                updateDeptHeader();
			}
		});
	})
    .catch(error => console.error("Error fetching data:", error));

    // ê²€ìƒ‰ ì´ë²¤íŠ¸ ì²˜ë¦¬
    searchBox.addEventListener("input", function () {
    	const searchText = searchBox.value.trim().toLowerCase();

        // ë¶€ì„œ ì„ íƒ ì—¬ë¶€ì— ë”°ë¼ í•„í„°ë§
        const filteredUsers = (currentDeptUsers.length > 0 ? currentDeptUsers : allUsers).filter(user => user.userNm.toLowerCase().includes(searchText) || (user.ofcpsNm && user.ofcpsNm.toLowerCase().includes(searchText)));

        updateDeptList(filteredUsers); // ì´ í•œ ì¤„ë¡œ í•„í„° ë°˜ì˜
        
     // dept-headerì—ì„œ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì²˜ë¦¬ ì‹œ
        checkbox.addEventListener("change", function () {
            const deptUsers = allUsers.filter(user => user.orgnztNm === dept);

            if (checkbox.checked) {
                deptUsers.forEach(user => selectedUsers.add(user.userNm));
            } else {
                deptUsers.forEach(user => selectedUsers.delete(user.userNm));
            }

            // ğŸ” í˜„ì¬ í•„í„°ë§ëœ ì‚¬ìš©ì ëª©ë¡ ê¸°ì¤€ìœ¼ë¡œ dept-list ë‹¤ì‹œ ë Œë”ë§
            deptUsers.forEach(user => {
        const li = Array.from(deptList.children).find(item =>
            item.textContent.includes(user.userNm)
        );
        if (li) {
            if (checkbox.checked) {
                li.classList.add("selected");
                li.style.backgroundColor = "#f0f8ff";
            } else {
                li.classList.remove("selected");
                li.style.backgroundColor = "";
            }
        }
    });

            const searchText = searchBox.value.trim().toLowerCase();
            const filteredUsers = (currentDeptUsers.length > 0 ? currentDeptUsers : allUsers).filter(user =>
                user.userNm.toLowerCase().includes(searchText) ||
                (user.ofcpsNm && user.ofcpsNm.toLowerCase().includes(searchText))
            );

            // ğŸ§  dept-list ì—…ë°ì´íŠ¸ë¡œ ì„ íƒ ìŠ¤íƒ€ì¼ ë°˜ì˜
            updateDeptList(filteredUsers);
        });

	});

    function addUserToRightBox(user) {
    	const readBox = document.querySelectorAll(".right-box")[0];

        // ì¤‘ë³µ ë°©ì§€ (ì´ë¯¸ ìˆëŠ” IDë©´ ì¶”ê°€ ì•ˆ í•¨)
        if (readBox.querySelector(`[data-id="${user.emplyrId}"]`)) return;

        if (!user.emplyrId) {
            console.error("emplyrIdê°€ ëˆ„ë½ëœ ì‚¬ìš©ì ë°ì´í„°:", user);
            return; // ëˆ„ë½ëœ ë°ì´í„°ëŠ” ì¶”ê°€í•˜ì§€ ì•ŠìŒ
        }

        const userDiv = document.createElement("div");
        userDiv.textContent = `${user.userNm} (${user.ofcpsNm || "ì§ì±… ì—†ìŒ"})`;
        userDiv.dataset.id = user.emplyrId; // emplyrIdë¥¼ data-idë¡œ ì„¤ì •

        readBox.appendChild(userDiv);
    }
    // dept-list ì—…ë°ì´íŠ¸ í•¨ìˆ˜
   function updateDeptList(users) {
    deptList.innerHTML = ""; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”
    users.forEach(user => {
        const newLi = document.createElement("li");
        newLi.textContent = `${user.userNm} (${user.ofcpsNm || "ì§ì±… ì—†ìŒ"})`;
        newLi.dataset.id = user.emplyrId;

        // ì„ íƒëœ ì‚¬ì› ë°°ê²½ìƒ‰ ìœ ì§€
        if (selectedUsers.has(user.emplyrId)) {
    newLi.classList.add("selected");
    newLi.style.backgroundColor = "#f0f8ff";
}

        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
        newLi.addEventListener("click", function () {
            if (selectedUsers.has(user.emplyrId)) {
                selectedUsers.delete(user.emplyrId);
                newLi.style.backgroundColor = ""; // ì„ íƒ í•´ì œ
                newLi.classList.remove("selected"); // ì„ íƒ í•´ì œ
            } else {
            	selectedUsers.add(user.emplyrId);
                newLi.style.backgroundColor = "#f0f8ff"; // ì„ íƒ ì¶”ê°€
                newLi.classList.add("selected"); // ì„ íƒ ì¶”ê°€
            }
            	 // ğŸ’¡ ì—¬ê¸°ì„œ ê´€ë ¨ ë¶€ì„œì˜ ì²´í¬ë°•ìŠ¤ ìƒíƒœë¥¼ ê°±ì‹ !
                const deptName = user.orgnztNm;
                const deptUsers = allUsers.filter(u => u.orgnztNm === deptName);
                const allSelected = deptUsers.every(u => selectedUsers.has(u.userNm));

                const checkbox = Array.from(deptHeader.querySelectorAll("input[type='checkbox']")).find(cb => {
                    return cb.nextSibling?.textContent === deptName;
                });

                if (checkbox) checkbox.checked = allSelected;
            });
            deptList.appendChild(newLi);
        });
}
            	




   	// dept-header ì—…ë°ì´íŠ¸ í•¨ìˆ˜
   	function updateDeptHeader() {
		deptHeader.innerHTML = ""; // ê¸°ì¡´ í—¤ë” ì´ˆê¸°í™”
        selectedDepts.forEach(dept => {
        	const checkbox = document.createElement("input");
            checkbox.type = "checkbox";
            checkbox.checked = false;

            const label = document.createElement("label");
            label.textContent = dept;
            label.style.fontWeight = "500";
            
            const searchText = searchBox.value.trim().toLowerCase();
            const filteredUsers = (currentDeptUsers.length > 0 ? currentDeptUsers : allUsers).filter(user =>
                user.userNm.toLowerCase().includes(searchText) ||
                (user.ofcpsNm && user.ofcpsNm.toLowerCase().includes(searchText))
            );

            
            // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸ ì¶”ê°€
            checkbox.addEventListener("change", function () {
    const deptUsers = allUsers.filter(user => user.orgnztNm === dept);

    if (checkbox.checked) {
        // ì„ íƒëœ ë¶€ì„œì˜ ëª¨ë“  ì‚¬ì›ì„ ì„ íƒì— ì¶”ê°€
        deptUsers.forEach(user => selectedUsers.add(user.emplyrId));
    } else {
        // í•´ë‹¹ ë¶€ì„œì˜ ëª¨ë“  ì‚¬ì› ì„ íƒ í•´ì œ
        deptUsers.forEach(user => selectedUsers.delete(user.emplyrId));
    }

    // ğŸ” dept-list ì—…ë°ì´íŠ¸í•´ì„œ UIì—ë„ ë°˜ì˜
    const searchText = searchBox.value.trim().toLowerCase();
    const filteredUsers = (currentDeptUsers.length > 0 ? currentDeptUsers : allUsers).filter(user =>
        user.userNm.toLowerCase().includes(searchText) ||
        (user.ofcpsNm && user.ofcpsNm.toLowerCase().includes(searchText))
    );

    updateDeptList(filteredUsers);  // ì—¬ê¸°ì„œ ë°°ê²½ìƒ‰ ë“± UI ê°±ì‹ 
});
            deptHeader.appendChild(checkbox);
           	deptHeader.appendChild(label);   	
        });
    }
   	function addToRightBox(buttons, selectedUsers) {
   	    buttons.forEach(button => {
   	        let rightBox;

   	        if (button.id === "readButton") {
   	            rightBox = document.querySelector(".right-panel .right-box:nth-child(1)");
   	        } else if (button.id === "writeButton") {
   	            rightBox = document.querySelector(".right-panel .right-box:nth-child(2)");
   	        } else if (button.id === "manageButton") {
   	            rightBox = document.querySelector(".right-panel .right-box:nth-child(3)");
   	        }

   	        if (rightBox) {
   	            selectedUsers.forEach(user => {
   	                if (!Array.from(rightBox.children).some(child => child.dataset.id === user.id)) {
   	                    const newDiv = document.createElement("div");
   	                    newDiv.textContent = user.text; // ì‚¬ìš©ì IDë¥¼ í‘œì‹œ
   	                    newDiv.dataset.id = user.id; // emplyrIdë¥¼ data-idë¡œ ì„¤ì •
   	                    rightBox.appendChild(newDiv);
   	                }
   	            });
   	        } else {
   	            console.error("right-boxë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
   	        }
   	    });
   	}

		function getSelectedUsers() {
			return Array.from(deptList.querySelectorAll("li.selected")).map(li => ({
		        text : li.textContent.trim(),
		        id: li.dataset.id
		    }));
		}

		function handleButtonClick(buttons) {
			const selectedUsers = getSelectedUsers();
			if (selectedUsers.length === 0) {
				alert("ì„ íƒëœ ì‚¬ì›ì´ ì—†ìŠµë‹ˆë‹¤.");
				return;
			}
			addToRightBox(buttons, selectedUsers);
		}

		if (readButton) {
			readButton.addEventListener("click", function (event) {
				event.preventDefault();
				handleButtonClick([readButton]);
			});
		} else {
			console.error("readButton ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		}

		if (writeButton) {
			writeButton.addEventListener("click", function (event) {
				event.preventDefault();
				handleButtonClick([readButton, writeButton]);
			});
		} else {
			console.error("writeButton ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		}

		if (manageButton) {
			manageButton.addEventListener("click", function (event) {
				event.preventDefault();
				handleButtonClick([readButton, writeButton, manageButton]);
			});
		} else {
			console.error("manageButton ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
		}
		
		// ì˜¤ë¥¸ìª½ ë°•ìŠ¤ì—ì„œ ì‚¬ìš©ì ì œê±° ì´ë²¤íŠ¸ ì¶”ê°€
	    const rightBoxes = document.querySelectorAll(".right-panel .right-box");
    rightBoxes.forEach((box, index) => {
        box.addEventListener("click", function (event) {
            const target = event.target;
            if (target.tagName === "DIV") {
                const user = target.textContent;

                // ì½ê¸° ë°•ìŠ¤ì—ì„œ ì‚­ì œ ì‹œ
                if (index === 0) {
                    box.removeChild(target);
                    const writeBox = document.querySelector(".right-panel .right-box:nth-child(2)");
                    const manageBox = document.querySelector(".right-panel .right-box:nth-child(3)");

                    [writeBox, manageBox].forEach(otherBox => {
                        Array.from(otherBox.children).forEach(child => {
                            if (child.textContent === user) {
                                otherBox.removeChild(child);
                            }
                        });
                    });
                }

                // ì“°ê¸° ë°•ìŠ¤ì—ì„œ ì‚­ì œ ì‹œ
                if (index === 1) {
                    box.removeChild(target);
                    const manageBox = document.querySelector(".right-panel .right-box:nth-child(3)");
                    Array.from(manageBox.children).forEach(child => {
                        if (child.textContent === user) {
                            manageBox.removeChild(child);
                        }
                    });
                }

                // ê´€ë¦¬ ë°•ìŠ¤ì—ì„œ ì‚­ì œ ì‹œ
                if (index === 2) {
                	 box.removeChild(target);
                }
            }
        });
    });
   
 // ì‚¬ì› ì„ íƒ ë°•ìŠ¤ì—ì„œ ì„ íƒëœ ì‚¬ì›ë“¤ì˜ IDë¥¼ ê°€ì ¸ì˜¤ê¸°
    function getSelectedEmployees() {
        const employeeSelect = document.getElementById('employeeSelect');
        if (!employeeSelect) {
            console.error("employeeSelect ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜í•˜ì—¬ ì˜¤ë¥˜ ë°©ì§€
        }

        // selectedOptionsê°€ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸
        const selectedItems = Array.from(employeeSelect.querySelectorAll('li.selected'));
        if (selectedItems.length === 0) {
            console.warn("ì„ íƒëœ í•­ëª©ì´ ì—†ìŠµë‹ˆë‹¤.");
            return []; // ë¹ˆ ë°°ì—´ ë°˜í™˜
        }

        let selectedEmployees = [];
        selectedItems.forEach(item => {
            selectedEmployees.push({
                emplyrId: item.dataset.id,  // ì„ íƒëœ ì‚¬ì›ì˜ ID (data-id ì†ì„± ì‚¬ìš©)
                authorCode: 'A-003'        // ì˜ˆì‹œë¡œ 'A-003' ê¶Œí•œ ì½”ë“œ ì„¤ì •
            });
        });

        return selectedEmployees;
    }

    // ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸ ì²˜ë¦¬
    document.getElementById('employeeSelect').addEventListener('click', function (event) {
    if (event.target.tagName === 'LI') {
        const li = event.target;
        if (li.classList.contains('selected')) {
            li.classList.remove('selected'); // ì„ íƒ í•´ì œ
            li.style.backgroundColor = '';   // ë°°ê²½ìƒ‰ ì´ˆê¸°í™”
        } else {
            li.classList.add('selected');    // ì„ íƒ ì¶”ê°€
            li.style.backgroundColor = '#f0f8ff'; // ì„ íƒëœ ë°°ê²½ìƒ‰
        }
    }
});

    
//ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
 const saveButton = document.getElementById("saveButton");
    if (saveButton) {
    	 saveButton.addEventListener("click", function () {
    		 const boardNameInput = document.getElementById("boardName");
    	        const boardName = boardNameInput ? boardNameInput.value : "";
    	        const boardType = document.querySelector('input[name="boardType"]:checked')?.id ;
    	        const parentBoardElement = document.getElementById("parentBoard");
    	        const parentBoard = boardType === "type1" ? null : parentBoardElement ? parentBoardElement.value : ""; // 'ê²Œì‹œíŒ ì¶”ê°€' ì„ íƒ ì‹œ nullë¡œ ì„¤ì •
    	        const useAt = document.querySelector('input[name="useAt"]:checked')?.value || "Y";
    	        const rightBoxes = document.querySelectorAll(".right-panel .right-box");

    	        const rightsMap = {
    	        		read: Array.from(rightBoxes[0].children).map(div => div.dataset.id).filter(id => id),
    	        	    write: Array.from(rightBoxes[1].children).map(div => div.dataset.id).filter(id => id),
    	        	    manage: Array.from(rightBoxes[2].children).map(div => div.dataset.id).filter(id => id)
    	        };

    	        // ê¶Œí•œ ì½”ë“œì— ë”°ë¼ ê¶Œí•œ ë¶€ì—¬
    	        const selectedRights = [];

    	     // ëª¨ë“  ì‚¬ìš©ìì— ëŒ€í•´ ê¶Œí•œ ì½”ë“œ ì„¤ì •
    	        allUsers.forEach(user => {
    	        	 if (!user.emplyrId) return;
    	        	 
    	        	 let authorCode;
    	            // emplyrIdê°€ nullì´ê±°ë‚˜ undefinedì¸ ê²½ìš°ëŠ” ì œì™¸
    	            if(rightsMap.write.includes(user.emplyrId) && rightsMap.manage.includes(user.emplyrId)) {
    	                authorCode = "A-003"; // ì½ê¸°+ì“°ê¸°+ê´€ë¦¬
    	            } else if (rightsMap.read.includes(user.emplyrId) && rightsMap.write.includes(user.emplyrId)) {
                        authorCode = "A-002";
                    } else if (rightsMap.read.includes(user.emplyrId)) {
                        authorCode = "A-001";
                    }
    	            if (authorCode) {
    	                selectedRights.push({
    	                    emplyrId: user.emplyrId,
    	                    authorCode
    	                });
    	            }
    	        });

    	     // ë””ë²„ê¹…: selectedRights ë°ì´í„° í™•ì¸
    	        console.log("Selected Rights:", selectedRights);
    	     
    	     // getSelectedEmployees()ì—ì„œ ì„ íƒëœ ì‚¬ìš©ìë“¤ì˜ ê¶Œí•œì„ ì¶”ê°€
    	        const selectedEmployees = getSelectedEmployees(); // getSelectedEmployees í˜¸ì¶œ
    	        selectedEmployees.forEach(employee => {
    	            const existingUser = selectedRights.find(user => user.emplyrId === employee.emplyrId);
    	            if (!existingUser) {
    	                selectedRights.push({
    	                    emplyrId: employee.emplyrId,
    	                    authorCode: employee.authorCode
    	                });
    	            }
    	        });
    	     // 'ê²Œì‹œíŒ ì¶”ê°€' ì„ íƒ ì‹œ ê¶Œí•œ ê²€ì¦ ê±´ë„ˆë›°ê¸°
                if (boardType !== "type1" && selectedRights.length === 0) {
                    alert("ê¶Œí•œì„ ì„ íƒí•˜ì„¸ìš”.");
                    return;
                }
    	        
    	        /* rightsMap.manage.forEach(emplyrId => {
    	            const existingUser = selectedRights.find(user => user.emplyrId === emplyrId);
    	            if (existingUser) {
    	                existingUser.authorCode = "A-003"; // ê´€ë¦¬ ê¶Œí•œ
    	            } else {
    	                selectedRights.push({ emplyrId, authorCode: "A-003" });
    	            }
    	        }); */

    	   

    	        const requestData = {
    	            boardName: boardName,
    	            boardType: boardType,
    	            parentBoard: parentBoard,
    	            useAt: useAt,
    	            selectedRights: selectedRights // ê¶Œí•œ ì •ë³´ í¬í•¨
    	        };

    	        console.log("ì „ì†¡í•  ë°ì´í„°:", requestData);

    	        fetch('/egowaeyo/bbsMaster/saveBoard', {
    	            method: "POST",
    	            headers: {
    	                "Content-Type": "application/json"
    	            },
    	            body: JSON.stringify(requestData)
    	        })
    	        .then(response => {
    	            if (!response.ok) {
    	                throw new Error(`HTTP error! status: ${response.status}`);
    	            }
    	            return response.json();
    	        })
    	        .then(data => {
    	            if (data.success) {
    	                alert("ê²Œì‹œíŒì´ ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.");
    	            } else {
    	                alert("ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + data.error);
    	            }
    	        })
    	        .catch(error => alert(`ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`));
    	    });
    	} else {
    	    console.error("saveButton ìš”ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
    	}
    
 
        });
   </script>

	<style>
body, html {
	background: #faf9f7;
	font-family: 'Noto Sans KR', sans-serif;
}

.egowaeyo {
	font-size: 20px;
	font-weight: 700;
	color: #222;
	margin-bottom: 8px;
	margin-bottom: 10px;
}

.arrow-icon {
	width: 14px;
	height: 14px;
	margin-left: 8px;
	filter: invert(68%) sepia(0%) saturate(0%) hue-rotate(240deg)
		brightness(104%) contrast(89%);
}

.modal-wrap {
	padding: 24px;
	background: #fff;
}

.modal-close {
	position: absolute;
	top: 24px;
	right: 32px;
	font-size: 28px;
	color: #888;
	background: none;
	border: none;
	cursor: pointer;
}

.setting-title {
	font-size: 18px;
	font-weight: 700;
	margin-bottom: 8px;
}

.setting-checkbox {
	font-size: 16px;
	font-weight: 500;
	margin-left: 24px;
	display: flex;
	align-items: center;
	gap: 4px;
}

.main-area {
	display: flex;
	gap: 15px;
	margin-top: 16px;
	align-items: flex-start;
}

.left-panel {
	width: 230px;
	background: #fff;
	border: 1.5px solid #e5e5e5;
	border-radius: 12px;
	padding: 10px 18px;
	height: 304px;
	box-sizing: border-box;
}

.search-box {
	display: flex;
	align-items: center;
	margin-bottom: 0;
}

.search-box input {
	width: 300px;
	border: 1.5px solid #e5e5e5;
	border-radius: 8px;
	height: 38px;
	padding: 0 38px 0 12px;
	font-size: 15px;
	background: #fff;
}

.search-box .search-icon {
	position: relative;
	left: -32px;
	color: #bbb;
	font-size: 18px;
	pointer-events: none;
}

.dept-list-wrap {
	border: 1.5px solid #e5e5e5;
	border-radius: 8px;
	background: #faf9f7;
	padding: 12px 0;
	width: 300px;
}

.dept-list-header {
	display: flex;
	align-items: center;
	font-size: 16px;
	font-weight: 500;
	margin-bottom: 8px;
	padding-left: 16px;
	gap: 6px;
}

.dept-list-header input[type="checkbox"] {
	margin-right: 2px;
	accent-color: #222;
}

.dept-list {
	list-style: none;
	padding: 0 16px;
	margin: 0;
}

.dept-list li {
	display: flex;
	align-items: center;
	justify-content: space-between;
	font-size: 15px;
	margin-bottom: 4px;
	color: #444;
	height: 28px;
}

.dept-list .dept {
	color: #bbb;
	font-size: 15px;
	margin-left: 6px;
}

.dept-btns .btn {
	background: #f6f5e9;
	border: 1px solid #d6d3b3;
	color: #444;
	font-size: 13px;
	border-radius: 4px;
	min-width: 70px;
	text-align: center;
	transition: background 0.2s;
	box-shadow: none;
}

.dept-btns .btn:hover {
	background: #ecead2;
	color: #222;
}

.right-panel {
	display: flex;
	flex-direction: column;
	gap: 20px;
	min-width: 220px;
	max-width: 260px;
	align-items: flex-start;
	margin-top: 32px;
}

.right-box {
	border: 1.5px solid #e5e5e5;
	border-radius: 10px;
	background: #faf9f7;
	min-height: 70px;
	max-height: 70px;
	padding: 16px 18px;
	font-size: 15px;
	color: #222;
	display: flex;
	flex-direction: column;
	justify-content: center;
	width: 220px;
	box-sizing: border-box;
}

.arrow {
	font-size: 22px;
	color: #bdbdbd;
	margin: 0 8px;
	vertical-align: middle;
	align-self: center;
}

@media ( max-width : 900px) {
	.main-area {
		flex-direction: column;
		gap: 16px;
	}
	.left-panel, .center-panel, .right-panel {
		min-width: 0;
		max-width: 100%;
	}
	.right-panel {
		flex-direction: row;
		gap: 12px;
	}
	.right-box {
		min-width: 120px;
		width: 100%;
	}
}

@media ( max-width : 600px) {
	.modal-wrap {
		padding: 8px;
	}
	.main-area {
		flex-direction: column;
		gap: 8px;
	}
	.left-panel, .center-panel, .right-panel {
		padding: 8px 4px;
	}
	.right-panel {
		flex-direction: column;
		gap: 8px;
	}
	.right-box {
		padding: 8px 8px;
	}
}

input[type="checkbox"] {
	vertical-align: middle;
	accent-color: #222;
}
</style>
</div>
</html>
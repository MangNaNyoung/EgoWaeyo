<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<main layout:fragment="content">
	<style>
body {
	background: #fff;
}

.custom-title {
	font-size: 20px;
	font-weight: 700;
	margin-bottom: 0;
	letter-spacing: -1px;
}

.custom-header {
	background: #fafafa;
	border-bottom: 2px solid #e5e5e5;
	padding: 25px 10px 20px 10px;
	margin-bottom: 0;
}

.post-list-item {
	border-bottom: 1px solid #f2f2f2;
	padding: 25px 0 25px 0;
	display: flex;
	align-items: flex-start;
	cursor: pointer;
}

.avatar {
	width: 36px;
	height: 36px;
	background: #e5e5e5;
	border-radius: 50%;
	margin-right: 16px;
	margin-top: 5px;
	flex-shrink: 0;
}

.post-title {
	font-size: 15px;
	font-weight: 500;
	margin-bottom: 2px;
	color: #222;
	display: inline-block;
	margin-right: 8px;
}

.post-meta {
	font-size: 14px;
	color: #888;
	display: flex;
	align-items: center;
	gap: 16px;
}

.post-icon {
	font-size: 14px;
	color: #4a90e2;
	margin-left: 2px;
	margin-right: 2px;
}

.post-count {
	font-size: 14px;
	color: #4a90e2;
	margin-left: 2px;
}
li.li_name {
  margin-bottom: 15px;
}

@media ( max-width : 900px) {
	.container {
		padding-left: 8px;
		padding-right: 8px;
	}
	.avatar {
		width: 28px;
		height: 28px;
		margin-right: 8px;
	}
	.post-title {
		font-size: 13px;
	}
	.post-meta {
		font-size: 12px;
		gap: 8px;
	}
	.post-list-item {
		padding: 18px 0 0 0;
	}
}
</style>
	<!-- ì „ì²´ ë¬¸ì„œë¥¼ ê°ì‹¸ëŠ” div ì‹œì‘-->
	<div class="d-flex">
		<!-- slideë¥¼ ê°ì‹¸ëŠ” div ì‹œì‘-->
		<div id="slid" style="height: 1000px" class="col-2 border-end">
			<!-- slid ë‚´ìš© ì‹œì‘ -->
			<div id="board-panel" class="p-4 ps-0 mt-5">
				<h5>ê²Œì‹œíŒ</h5>

				<ul class="no_dot mt-4 fw-bold parentsProjects">
					<!--í”„ë¡œì íŠ¸ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
				</ul>


				<ul class="no_dot">
					<li><span class="addBoard" data-bs-toggle="modal"
						data-bs-target="#addProjectModal" style="cursor: pointer;">+
							ê²Œì‹œíŒì¶”ê°€</span></li>
				</ul>
			</div>
			<!-- slide ë‚´ìš© ë -->

		</div>
		<!-- slide ê°ì‹¸ëŠ” div ë -->

		<!-- ë‚´ìš©(ì›ë³¸) ê°ì‹¸ëŠ” div -->
		<div class="flex-grow-1 ">
			<!-- ë‚´ìš©(ì›ë³¸) ì‹œì‘  -->
			<div class="custom-header">
				<div class="container-fluid">
					<div class="d-flex align-items-center justify-content-between">
						<div class="custom-title"></div>

						<!-- í¼ ì‹œì‘ -->
						<form class="search-bar d-flex align-items-center gap-2 me-4"
							style="width: 800px;">
							<select class="form-select" id="formSelect"style="width: 200px;">
							</select> 
							<select class="form-select" id="howSelect" style="width: 200px;">
								<option value="a">ì œëª©+ë‚´ìš©</option>
								<option value="b">ì‘ì„±ì</option>
							</select> <input class="form-control" id="filterInput" type="text" style="width: 200px;"
								placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
							<button id="filterButton"
								class="btn btn-dark d-flex align-items-center justify-content-center"
								type="submit" style="height: 38px;">
								<span class="visually-hidden">ê²€ìƒ‰</span>
								<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18"
									fill="currentColor" class="bi bi-search" viewBox="0 0 16 16">
									<path
										d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85zm-5.442 1.398a5.5 5.5 0 1 1 0-11 5.5 5.5 0 0 1 0 11z" />
								</svg>
							</button>
							<button class="btn btn-success" id="submitButton"
								style="width: 100px; margin-left: 100px;" type="button">ê¸€ì“°ê¸°</button>
						</form>
					</div>
				</div>
			</div>

			<!-- ë¦¬ìŠ¤íŠ¸ -->
			<div class="container-fluid px-4">
				<!-- ë¦¬ìŠ¤íŠ¸ ë°˜ë³µ -->
				<div class="post-list-item">
					<div class="avatar"></div>
					<div>
						<div>
							<span class="post-title"></span> <span class="reply"></span>
							<span class="post-count"></span>
						</div>
						<div class="post-meta">
							<span class="post-writer"></span> <span class="post-dt"></span>
							<span class="post-tm"></span>
						</div>
					</div>
				</div>
				<!-- ë‚´ìš©(ì›ë³¸) ë -->

			</div>
			<!-- ì›ë³¸(ë‚´ìš©) ë‚´ìš© ë -->

		</div>
		<!-- ì „ì²´ ë¬¸ì„œë¥¼ ê°ì‹¸ëŠ” íƒœê·¸ ë-->

		<!-- ëª¨ë‹¬ì€ ë°”ê¹¥ìœ¼ë¡œ ë¹¼ì„œ ë„£ì–´ì£¼ì„¸ìš” -->
		<div th:replace="article/addProjectModal :: addProjectModal"></div>
		<div th:replace="article/editProjectModal :: editProjectModal"></div>
		<!-- ìŠ¤í¬ë¦½íŠ¸ë„ ë³µì‚¬í•´ì„œ ê°€ì ¸ê°€ë©´ ë©ë‹ˆë‹¤ -->
		<script th:inline=javaScript>
		let barClicked = [[${barContect}]]
		if (barClicked) {
			 barLending(barClicked);
		console.log("barClicked:", barClicked); // ë””ë²„ê¹…ìš© ë¡œê·¸					 
		}
		let manageClick;
		
			function openModal() {
				fetch('addProjectModal.html')
					.then(response => response.text())
					.then(html => {
						const modalContainer = document.getElementById('modal-container');
						modalContainer.innerHTML = html;
						modalContainer.classList.remove('hidden');
					})
					.catch(error => console.error('Error loading modal:', error));
			}

			function closeModal() {
				const modalContainer = document.getElementById('modal-container');
				modalContainer.classList.add('hidden');
				modalContainer.innerHTML = ''; // ëª¨ë‹¬ ë‚´ìš© ì´ˆê¸°í™”
			}


			// í”„ë¡œì íŠ¸ ìˆ˜ì • ëª¨ë‹¬
			/* function openModal() {
				fetch('editProjectModal.html')
					.then(response => response.text())
					.then(html => {
						const modalContainer = document.getElementById('modal-container');
						modalContainer.innerHTML = html;
						modalContainer.classList.remove('hidden');
					})
					.catch(error => console.error('Error loading modal:', error));
			}

			function closeModal() {
				const modalContainer = document.getElementById('modal-container');
				modalContainer.classList.add('hidden');
				modalContainer.innerHTML = ''; // ëª¨ë‹¬ ë‚´ìš© ì´ˆê¸°í™”
			} */

			$('document').ready(function () {
				const urlParams = new URLSearchParams(window.location.search);
				const paramBbsId = urlParams.get('bbsId'); 
				const paramBbsNm = urlParams.get('bbsNm'); 
				if (!paramBbsId) {
					makList('BBSMSTR_000000000021kioSbKFeeb'); 
					$(".custom-title").text("ğŸ“Œ ê³µì§€ì‚¬í•­"); // ê¸°ë³¸ ê²Œì‹œíŒ ì´ë¦„ ì„¤ì •)
				} else {
					makList(paramBbsId);
					$(".custom-title").text(paramBbsNm);
				}
				});
			// ì‚¬ì´ë“œë°”
			document.addEventListener("DOMContentLoaded", function () {
				fetch('/egowaeyo/bbsMaster/groupedBbsData')
					.then(response => response.json())
					.then(data => {
						console.log("Fetched Data:", data); // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€

						const parentProjectsList = document.querySelector("ul.parentsProjects");
						if (parentProjectsList) {
							parentProjectsList.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

							Object.entries(data).forEach(([codeNm, bbsList]) => {
								const groupItem = document.createElement("li");
								groupItem.classList.add("li_name");
								
								if(codeNm == "ğŸ“Œ ê³µì§€ì‚¬í•­" && barClicked !=null){
									document.querySelector('.custom-title').textContent = codeNm;
								}
								
								// 'ê³µì§€ì‚¬í•­'ì¼ ê²½ìš° codeNm ìˆ¨ê¸°ê¸°
						          if (codeNm !== "ğŸ“Œ ê³µì§€ì‚¬í•­") {
						            groupItem.textContent = codeNm;
						            
						            const ulImg = document.createElement("img");
									ulImg.setAttribute("data-bs-toggle", "modal");
									ulImg.setAttribute("data-bs-target", "#addProjectModal");
									ulImg.setAttribute("class", "img-icon addUnderBoard");
									ulImg.setAttribute("src", "/egowaeyo/assets/images/icon/manage.png");
									ulImg.setAttribute("style", "cursor: pointer; margin-left: 8px;");
									groupItem.appendChild(ulImg);
						          }

								// ìƒˆë¡œìš´ ul íƒœê·¸ ìƒì„±
								const subList = document.createElement("ul");

							


								bbsList.forEach(bbs => {
									// li íƒœê·¸ ìƒì„±
									const listItem = document.createElement("li");
									// li íƒœê·¸ì— no_dot í´ë˜ìŠ¤ ì¶”ê°€
									listItem.classList.add("no_dot");
									listItem.setAttribute("style", "cursor: pointer; margin-left:-20px;");
									listItem.setAttribute("data-bbs-id", bbs.bbsId); // bbsNmì„ data ì†ì„±ìœ¼ë¡œ ì¶”ê°€
									listItem.setAttribute("data-code", bbs.code); // bbsNmì„ data ì†ì„±ìœ¼ë¡œ ì¶”ê°€

									// img íƒœê·¸ ìƒì„±
									const img = document.createElement("img");
									img.setAttribute("data-bs-toggle", "modal");
									img.setAttribute("data-bs-target", "#addProjectModal");
									img.setAttribute("class", "img-icon");
									img.setAttribute("src", "/egowaeyo/assets/images/icon/manage.png");
									img.setAttribute("style", "cursor: pointer; margin-left: 8px;");

									// bbsNm í…ìŠ¤íŠ¸ ì¶”ê°€
									const textNode = document.createTextNode(bbs.bbsNm);
									
									// ê³µì§€ì‚¬í•­ì˜ bbsNmì— ìŠ¤íƒ€ì¼ ì ìš©
						            if (codeNm === "ğŸ“Œ ê³µì§€ì‚¬í•­") {
						              listItem.style.cssText = "font-weight: bold !important; cursor: pointer; margin-left:-32px; margin-bottom: 10px;";
						            }

									// liì— í…ìŠ¤íŠ¸ì™€ img ì¶”ê°€
									listItem.appendChild(textNode);
									listItem.appendChild(img);

									listItem.style.fontWeight = "normal"; // li íƒœê·¸ì— normal ìŠ¤íƒ€ì¼ ì ìš©
									subList.appendChild(listItem);									
								});

								groupItem.appendChild(subList);
								parentProjectsList.appendChild(groupItem);
								
							
							});
						}
					})
					.catch(error => console.error('Error fetching grouped BBS data:', error));
				
			}
			
			);

			// ê²Œì‹œíŒëª… í´ë¦­ -> í—¤ë”ëª… ë³€ê²½
			document.addEventListener("DOMContentLoaded", function () {
				const parentProjectsList = document.querySelector("ul.parentsProjects");
				const customTitle = document.querySelector(".custom-title");
				const postListContainer = document.querySelector(".container-fluid.px-4");
				

				// ê²Œì‹œíŒ ì´ë¦„(li)ì„ í´ë¦­í–ˆì„ ë•Œ
				parentProjectsList.addEventListener("click", function (e) {
					const clicked = e.target;

					// ê²Œì‹œíŒ ì´ë¦„(li)ì˜ í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œë§Œ ì²˜ë¦¬
					if (clicked.tagName === "LI" && clicked.textContent.trim() !== "") {
						const bbsNm = clicked.childNodes[0].nodeValue.trim(); // ê²Œì‹œíŒ ì´ë¦„
						const bbsId = clicked.getAttribute("data-bbs-id"); // ê²Œì‹œíŒ ID (liì— data ì†ì„±ìœ¼ë¡œ ë„£ì–´ì•¼ í•¨)

						if (!bbsId) {
					        console.warn("bbsIdê°€ ì—†ìŠµë‹ˆë‹¤.");
					        return;
					      }

						// ì œëª© ë³€ê²½
						if (customTitle) {
							customTitle.textContent = bbsNm;
						}

						
						makList(bbsId)
						
						}
						
				});
				
				// ê²Œì‹œê¸€ ê²€ìƒ‰ í•„í„° ìƒìœ„ê²Œì‹œíŒ
				  fetch("/egowaeyo/article/bbsFilter")
				  .then(response => response.json())
			       .then(data => {
			           console.log("Fetched Data:", data);
			           const formSelect = document.getElementById("formSelect");
			           formSelect.innerHTML = '<option value="">ê²Œì‹œíŒì„ ì„ íƒí•˜ì„¸ìš”</option>';
			           data.forEach(item => {
			               const option = document.createElement("option");
			               option.value = item.BBS_ID;
			               option.textContent = item.BBS_NM;
			               formSelect.appendChild(option);
			           });
			       })
			       .catch(error => console.error("Error fetching BBS filter:", error));
				
				// ê²Œì‹œê¸€ ê²€ìƒ‰ í•„í„° ì´ë²¤íŠ¸
				  const filterButton = document.getElementById("filterButton");

				    filterButton.addEventListener("click", function (e) {
				        e.preventDefault();

				        const bbsId = document.getElementById("formSelect").value;
				        const searchType = document.getElementById("howSelect").value;
				        const searchKeyword = document.getElementById("filterInput").value;

				        if (!bbsId || !searchType || !searchKeyword) {
				            alert("ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
				            return;
				        }

				        fetch(`/egowaeyo/article/filterArticles?bbsId=${bbsId}&searchType=${searchType}&searchKeyword=${searchKeyword}`)
				            .then(response => response.json())
				            .then(data => {
				                const postListContainer = document.querySelector(".container-fluid.px-4");
				                postListContainer.innerHTML = ""; // ê¸°ì¡´ ë¦¬ìŠ¤íŠ¸ ì´ˆê¸°í™”

				                data.forEach(post => {
				                    const postItem = document.createElement("div");
				                    postItem.className = "post-list-item";
				                    
				                    // ë‚ ì§œ ì²˜ë¦¬
				                    const dateTime = post.FRST_REGIST_PNTTM;
				                    const formattedDate = dateTime ? dateTime.split(' ')[0] : 'ë‚ ì§œ ì—†ìŒ';
				                    const formattedTime = dateTime ? dateTime.split(' ')[1] : 'ì‹œê°„ ì—†ìŒ';

				                    postItem.innerHTML = `
				                        <div class="avatar"></div>
				                        <div>
				                            <div class="post-title">${post.NTT_SJ}<span style="font-size:14px; color:#4a90e2; margin-left:5px;">ğŸ‘ ${post.RDCNT}</span></div>
				                            <div class="post-meta">
				                                <span>${post.NTCR_NM}</span>
				                                <span>${formattedDate}</span>
				                                <span>${formattedTime}</span>
				                            </div>
				                        </div>
				                    `;
				                    postListContainer.appendChild(postItem);
				                });
				            })
				            .catch(error => {
				                console.error("Error fetching filtered articles:", error);
				                alert("ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
				            });
				    });
				    
				});
		  // ê²Œì‹œê¸€ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° í•¨ìˆ˜
		function makList(bbsId){
			// ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸°
			fetch(`/egowaeyo/article/selectBbsAll?bbsId=${encodeURIComponent(bbsId)}`)
			  .then(res => {
			    if (!res.ok) throw new Error("ê²Œì‹œê¸€ ìš”ì²­ ì‹¤íŒ¨");
			    return res.json();  // ì„œë²„ì—ì„œ ì—¬ëŸ¬ ê²Œì‹œê¸€ì„ JSON ë°°ì—´ë¡œ ë°˜í™˜
			  })
			  .then(posts => {
			    const postListContainer = document.querySelector(".container-fluid.px-4");
			    postListContainer.innerHTML = ""; // ê¸°ì¡´ ê²Œì‹œê¸€ ì´ˆê¸°í™”

			    // postsê°€ ë°°ì—´ì¸ ê²½ìš°
			    if (Array.isArray(posts) && posts.length > 0) {
			      posts.forEach(post => {
			    	
			        const postItem = document.createElement("div");
			        postItem.className = "post-list-item";
			        postItem.setAttribute("data-bbs-id", post.bbsId);
			        postItem.setAttribute("data-ntt-id", post.nttId);
			        
			        postItem.innerHTML = `
			          <div class="avatar"></div>
			          <div>
			            <div>
			              <span class="post-title">${post.nttSj}</span> 
			              <span class="post-icon">ğŸ‘</span>
			              <span class="post-count">${post.inqireCo}</span>
			            </div>
			            <div class="post-meta">
			              <span class="post-writer">${post.ntcrNm}</span>
			              <span class="post-dt">${post.frstRegisterPnttm.split(' ')[0]}</span>
			              <span class="post-tm">${post.frstRegisterPnttm.split(' ')[1]}</span>
			            </div>
			          </div>
			        `;
			        
			        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
						postItem.addEventListener("click", function () {
							const bbsId = this.getAttribute("data-bbs-id");
							const nttId = this.getAttribute("data-ntt-id");
							window.location.href = `/egowaeyo/article/articleDetail.do?bbsId=${bbsId}&nttId=${nttId}`;
					});
			        postListContainer.appendChild(postItem);
			      });
			    } else {
			      postListContainer.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
			    }
			  })
			  .catch(err => {
			    console.error("ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
			    postListContainer.innerHTML = "<p>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
			  });
		}
			
			
			
			
			
			// ê¸€ì“°ê¸°ë²„íŠ¼ í´ë¦­
			document.addEventListener("DOMContentLoaded", function () {
    			const submitButton = document.getElementById("submitButton");

    			submitButton.addEventListener("click", function () {
        			window.location.href = "articleRegister.do"; // ê¸€ì“°ê¸° í™”ë©´ìœ¼ë¡œ ì´ë™
   	 			});
			});
			function barLending(bbData){
				fetch(`/egowaeyo/article/selectBbsAll?bbsId=`+bbData)
				  .then(res => {
				    if (!res.ok) throw new Error("ê²Œì‹œê¸€ ìš”ì²­ ì‹¤íŒ¨");
				    return res.json();  // ì„œë²„ì—ì„œ ì—¬ëŸ¬ ê²Œì‹œê¸€ì„ JSON ë°°ì—´ë¡œ ë°˜í™˜
				  })
				  .then(posts => {
				    const postListContainer = document.querySelector(".container-fluid.px-4");
				    postListContainer.innerHTML = ""; // ê¸°ì¡´ ê²Œì‹œê¸€ ì´ˆê¸°í™”
					
				    console.log(posts)
				    // postsê°€ ë°°ì—´ì¸ ê²½ìš°
				    if (Array.isArray(posts) && posts.length > 0) {
				      posts.forEach(post => {
				    	
				        const postItem = document.createElement("div");
				        postItem.className = "post-list-item";
				        postItem.setAttribute("data-bbs-id", post.bbsId);
				        postItem.setAttribute("data-ntt-id", post.nttId);
				        
				        postItem.innerHTML = `
				          <div class="avatar"></div>
				          <div>
				            <div>
				              <span class="post-title">${post.nttSj}</span> 
				              <span class="post-icon">ğŸ‘</span>
				              <span class="post-count">${post.inqireCo}</span>
				            </div>
				            <div class="post-meta">
				              <span class="post-writer">${post.ntcrNm}</span>
				              <span class="post-dt">${post.frstRegisterPnttm.split(' ')[0]}</span>
				              <span class="post-tm">${post.frstRegisterPnttm.split(' ')[1]}</span>
				            </div>
				          </div>
				        `;
				        
				        // í´ë¦­ ì´ë²¤íŠ¸ ì¶”ê°€
						postItem.addEventListener("click", function () {
							const bbsId = this.getAttribute("data-bbs-id");
							const nttId = this.getAttribute("data-ntt-id");
							window.location.href = `/egowaeyo/article/articleDetail.do?bbsId=${bbsId}&nttId=${nttId}`;
					});
				        postListContainer.appendChild(postItem);
				      });
				    } else {
				      postListContainer.innerHTML = "<p>ê²Œì‹œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
				    }
				  })
				  .catch(err => {
				    console.error("ê²Œì‹œê¸€ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:", err);
				    postListContainer.innerHTML = "<p>ê²Œì‹œê¸€ì„ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.</p>";
				  });
				}
			$(".addBoard").click(function(){
				manageClick = "addBoard"
			})
			$(".addUnderBoard").click(function(){
				manageClick = "addUnderBoard"
			})
			
		</script>
	</div>
</main>

</html>
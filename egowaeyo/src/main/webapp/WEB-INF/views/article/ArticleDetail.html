<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<main layout:fragment="content">
	<style>
	
	.edit-container textarea {
    font-size: 14px;
    resize: vertical;
  }
  .comment-item {
    border-bottom: 1px solid #e5e5e5; /* ì—°í•œ íšŒìƒ‰ ì„  */
    padding-bottom: 10px; /* ëŒ“ê¸€ ê°„ ê°„ê²© */
    margin-bottom: 10px; /* ëŒ“ê¸€ ê°„ ê°„ê²© */
}
.comment-item:last-child {
    border-bottom: none; /* ë§ˆì§€ë§‰ ëŒ“ê¸€ì€ ì„  ì œê±° */
}
  
/* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
body {
	background: #fff;
}

.custom-title {
	font-size: 20px;
	font-weight: 700;
	margin-bottom: 0;
	letter-spacing: -1px;
}

.custom-header {
	background: #fafafa;
	border-bottom: 2px solid #e5e5e5;
	padding: 25px 10px 20px 10px;
	margin-bottom: 0;
}

.avatar {
	width: 36px;
	height: 36px;
	background: #e5e5e5;
	border-radius: 50%;
	margin-right: 16px;
	margin-top: 5px;
	flex-shrink: 0;
}

li.li_name {
	margin-bottom: 15px;
}

@media ( max-width : 900px) {
	.container {
		padding-left: 8px;
		padding-right: 8px;
	}
	.notice-title {
		font-size: 1.2rem;
	}
	.avatar {
		width: 28px;
		height: 28px;
	}
	.comment-avatar {
		width: 24px;
		height: 24px;
	}
}
</style>
	<!-- ì „ì²´ ë¬¸ì„œë¥¼ ê°ì‹¸ëŠ” div ì‹œì‘-->
	<div class="d-flex">
		<!-- slideë¥¼ ê°ì‹¸ëŠ” div ì‹œì‘-->
		<div id="slid" style="height: 1000px" class="col-2 border-end">
			<!-- slid ë‚´ìš© ì‹œì‘ -->
			<div id="board-panel" class="p-4 ps-0 mt-5">
				<h5>ê²Œì‹œíŒ</h5>

				<ul class="no_dot mt-4 fw-bold parentsProjects">
					<!--í”„ë¡œì íŠ¸ ëª©ë¡ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤. -->
				</ul>


				<ul class="no_dot">
					<li><span class="addBoard" data-bs-toggle="modal"
						data-type="add" data-bs-target="#addProjectModal"
						style="cursor: pointer;">+ ê²Œì‹œíŒì¶”ê°€</span></li>
				</ul>
			</div>
			<!-- slide ë‚´ìš© ë -->

		</div>
		<!-- slide ê°ì‹¸ëŠ” div ë -->

		<!-- ë‚´ìš©(ì›ë³¸) ê°ì‹¸ëŠ” div -->
		<div class="flex-grow-1 ">
			<!-- ë‚´ìš©(ì›ë³¸) ì‹œì‘  -->
			<div class="custom-header">
				<div class="container-fluid">
					<div class="d-flex align-items-center justify-content-between">
						<div class="custom-title"></div>


					</div>
				</div>
			</div>
			<!-- ìƒë‹¨ í—¤ë” -->
			<!-- content -->
			<div class="container pt-4">
				<!-- ìƒë‹¨ ë²„íŠ¼ ê·¸ë£¹ -->
				<div class="d-flex justify-content-end mb-3">
					<button id="editButton" class="btn btn-dark btn-sm me-2">ìˆ˜ì •</button>
					<button id="deleteButton" class="btn btn-dark btn-sm me-2">ì‚­ì œ</button>
					<button id="listButton" class="btn btn-dark btn-sm">ëª©ë¡</button>
				</div>

				<!-- ì œëª© ë° ì‘ì„±ì ì •ë³´ -->
				<div class="mb-3 ms-3">
					<h2 class="fw-bold mb-3" id="article-title"></h2>
					<div class="d-flex align-items-center">
						<div class="avatar me-3"></div>
						<div>
							<p class="mb-1" id="article-author"
								style="font-size: 15px; color: #444;"></p>
							<div class="d-flex align-items-center"
								style="font-size: 14px; color: #888;">
								<span id="article-date"></span> <span id="article-time"
									class="ms-2"></span> <span class="ms-3" id="article-view"></span>
							</div>
						</div>
					</div>
				</div>

				<!-- ì²¨ë¶€íŒŒì¼ ì •ë³´ -->
				<div class="mb-4">
					<div class="file-box p-3 border rounded ms-3 me-3">
						<p class="mb-2">
							<a href="#" class="ms-2 text-muted" id="download-all-link"
								style="font-size: 14px;">ì „ì²´ë‹¤ìš´ë¡œë“œ</a>
						</p>
						<div id="attached-file-box" class="form-control form-control-sm"
							style="background-color: #f8f9fa; border: 1px solid #ced4da; padding: 0.375rem 0.75rem;">
						</div>
					</div>
				</div>

				<!-- ê³µì§€ ë‚´ìš© -->
				<div class="mb-4 ms-3">
					<p class="notice-content" id="article-content">
						<span class="notice-date fw-bold"> </span>
					</p>
				</div>

				<hr class="mt-5 mb-4">
				<!-- ëŒ“ê¸€ ì…ë ¥ -->
				<div class="mb-4">
					<label class="comment-label d-flex align-items-center mb-2 ms-3">
						ğŸ’¬ ëŒ“ê¸€ </label>

					<div class="d-flex align-items-start ms-3 me-3 mt-4">
						<div>
							<div class="d-flex align-items-center"
								style="font-size: 14px; color: #888; margin-top: -5px;">
							</div>
						</div>
					</div>
					<div class="d-flex align-items-start ms-3 me-3 mt-2 mb-4">
						<textarea class="form-control comment-input me-2"
							id="commentContent" rows="3"></textarea>
						<button class="btn btn-dark" id="commentSubmitButton"
							style="width: 60px; height: 40px;">ë“±ë¡</button>
					</div>
				</div>

				<!-- ëŒ“ê¸€ëª©ë¡ -->
				<div class="mb-4 comment-item">

					<div id="commentList" class="ms-3 me-3 comment-text">
						<!-- ëŒ“ê¸€ì´ ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
					</div>
				</div>

				<nav aria-label="Page navigation" id="comment-pagination" >
					<ul class="pagination justify-content-center">
						<li class="page-item disabled"><a class="page-link" href="#"
							tabindex="-1">ì´ì „</a></li>
						<li class="page-item"><a class="page-link" href="#">1</a></li>
						<li class="page-item active"><a class="page-link" href="#">2</a></li>
						<li class="page-item"><a class="page-link" href="#">3</a></li>
						<li class="page-item"><a class="page-link" href="#">ë‹¤ìŒ</a></li>
					</ul>
				</nav>

			</div>
		</div>
		<div th:replace="article/addProjectModal :: addProjectModal"></div>

		<script th:inline=javaScript>
		let barClicked = [[${barContect}]]
		if (barClicked) {
			 barLending(barClicked);
		console.log("barClicked:", barClicked); // ë””ë²„ê¹…ìš© ë¡œê·¸					 
		}
		let manageClick;
		
		var myModalEl = document.getElementById('addProjectModal')
		myModalEl.addEventListener('show.bs.modal', function (event) {
		  let rt = event.relatedTarget; // ë””ë²„ê¹…ìš© ë¡œê·¸
		  let type = rt.getAttribute("data-type");
		  let bbsId = rt.getAttribute("data-bbs-id");// data-bbs-id ê°’ ê°€ì ¸ì˜¤ê¸°
		  
		  // ëª¨ë‹¬ ì´ˆê¸°í™”
		    document.querySelector(".modal-wrap").style.display = "none"; // ê¶Œí•œ ì„¤ì • ë¶€ë¶„ ìˆ¨ê¸°ê¸°
		    document.getElementById("boardTypeSelection").hidden = false; // ê²Œì‹œíŒ ìœ í˜• ì„ íƒ ë³´ì´ê¸°
		    toggleParentBoard(false); // ìƒìœ„ ê²Œì‹œíŒ UI ë¹„í™œì„±í™”
		    
		  //ì €ì¥ ë²„íŠ¼ ì´ë²¤íŠ¸ ì²˜ë¦¬
		  const saveButton = document.getElementById("saveButton");
		  
		  saveButton.removeEventListener("click", addClick); // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
		  saveButton.removeEventListener("click", updateCodeClick); // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
		  saveButton.removeEventListener("click", updateBbsClick); // ê¸°ì¡´ ì´ë²¤íŠ¸ ì œê±°
		  
		  const boardType = document.getElementById("boardTypeSelection");
		  
	
		  if(type == "add") {
			 document.querySelector('#addProjectModalLabel').textContent = "ê²Œì‹œíŒ ì¶”ê°€";
			 saveButton.addEventListener("click", addClick );
			
	      }
		  else if (type == "code") {
			  document.querySelector('#addProjectModalLabel').textContent = "ê·¸ë£¹ê²Œì‹œíŒ ê´€ë¦¬";
			  boardType.hidden = true
			  const code = rt.getAttribute("data-bbs-id");
			  insertCodeData(code); // codeë¥¼ insertCodeData í•¨ìˆ˜ì— ì „ë‹¬
			  saveButton.addEventListener("click", updateCodeClick );
		  }
		  else if (type == "bbs") {
			  document.querySelector('#addProjectModalLabel').textContent = "ê²Œì‹œíŒ ê´€ë¦¬";
			  boardType.hidden = true;
			  //document.getElementById("type2").checked = true; // ê²Œì‹œíŒ ìœ í˜•ì„ ì‚¬ìš©ìì§€ì •(type2)ìœ¼ë¡œ ì„¤ì •
			  toggleParentBoard(true); // ì‚¬ìš©ìì§€ì • ìœ í˜• UIë¥¼ ë°˜ì˜ (ìƒìœ„ ê²Œì‹œíŒ í™œì„±í™” ë“±)
			  document.querySelector(".modal-wrap").style.display = "block"; // ê¶Œí•œ ì„¤ì • ë¶€ë¶„(modal-wrap) ë³´ì´ë„ë¡ ì„¤ì •
			  insertData(type, bbsId); // bbsIdë¥¼ insertData í•¨ìˆ˜ì— ì „ë‹¬
			  saveButton.addEventListener("click", updateBbsClick);

		  }
		  });
		  

			$('document').ready(function () {
				const urlParams = new URLSearchParams(window.location.search);
				const paramBbsId = urlParams.get('bbsId'); 
				const paramBbsNm = urlParams.get('bbsNm'); 
				if (!paramBbsId) {
					makList('BBSMSTR_000000000021kioSbKFeeb'); 
					$(".custom-title").text("ğŸ“Œ ê³µì§€ì‚¬í•­"); // ê¸°ë³¸ ê²Œì‹œíŒ ì´ë¦„ ì„¤ì •)
				} else {
					makList(paramBbsId);
					$(".custom-title").text(paramBbsNm);
				}
				});
			// ì‚¬ì´ë“œë°”
			document.addEventListener("DOMContentLoaded", function () {
				fetch('/egowaeyo/bbsMaster/groupedBbsData')
					.then(response => response.json())
					.then(data => {
						console.log("Fetched Data:", data); // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€

						const parentProjectsList = document.querySelector("ul.parentsProjects");
						if (parentProjectsList) {
							parentProjectsList.innerHTML = ""; // ê¸°ì¡´ ë‚´ìš© ì´ˆê¸°í™”

							Object.entries(data).forEach(([codeNm, bbsList]) => {
								const groupItem = document.createElement("li");
								groupItem.classList.add("li_name");
								
								if(codeNm == "ğŸ“Œ ê³µì§€ì‚¬í•­" && barClicked !=null){
									document.querySelector('.custom-title').textContent = codeNm;
								}
								
								// 'ê³µì§€ì‚¬í•­'ì¼ ê²½ìš° codeNm ìˆ¨ê¸°ê¸°
						          if (codeNm !== "ğŸ“Œ ê³µì§€ì‚¬í•­") {
						            groupItem.textContent = codeNm;
						            
						            const ulImg = document.createElement("img");
						          
									ulImg.setAttribute("data-bs-toggle", "modal");
									ulImg.setAttribute("data-bs-target", "#addProjectModal");
									ulImg.setAttribute("class", "img-icon addUnderBoard");
									ulImg.setAttribute("src", "/egowaeyo/assets/images/icon/manage.png");
									ulImg.setAttribute("style", "cursor: pointer; margin-left: 8px;");
									ulImg.setAttribute("data-bbs-id", bbsList[0].bbsId); 
									ulImg.setAttribute("data-code", bbsList[0].code);

									ulImg.setAttribute("data-type", "code"); 
									
									groupItem.appendChild(ulImg);
						          }

								// ìƒˆë¡œìš´ ul íƒœê·¸ ìƒì„±
								const subList = document.createElement("ul");

							


								bbsList.forEach(bbs => {
									// li íƒœê·¸ ìƒì„±
									const listItem = document.createElement("li");
									// li íƒœê·¸ì— no_dot í´ë˜ìŠ¤ ì¶”ê°€
									listItem.classList.add("no_dot");
									listItem.setAttribute("style", "cursor: pointer; margin-left:-20px;");
									listItem.setAttribute("data-bbs-id", bbs.bbsId); // bbsNmì„ data ì†ì„±ìœ¼ë¡œ ì¶”ê°€
									listItem.setAttribute("data-code", bbs.code); // bbsNmì„ data ì†ì„±ìœ¼ë¡œ ì¶”ê°€

									// img íƒœê·¸ ìƒì„±
									const img = document.createElement("img");
									img.setAttribute("data-bs-toggle", "modal");
									img.setAttribute("data-bs-target", "#addProjectModal");
									img.setAttribute("class", "img-icon");
									img.setAttribute("id", "bbsManage");
									img.setAttribute("src", "/egowaeyo/assets/images/icon/manage.png");
									img.setAttribute("style", "cursor: pointer; margin-left: 8px;");
									img.setAttribute("data-bbs-id", bbs.bbsId); 
									img.setAttribute("data-type", "bbs"); 
									// bbsNm í…ìŠ¤íŠ¸ ì¶”ê°€
									const textNode = document.createTextNode(bbs.bbsNm);
									
									// ê³µì§€ì‚¬í•­ì˜ bbsNmì— ìŠ¤íƒ€ì¼ ì ìš©
						            if (codeNm === "ğŸ“Œ ê³µì§€ì‚¬í•­") {
						              listItem.style.cssText = "font-weight: bold !important; cursor: pointer; margin-left:-32px; margin-bottom: 10px;";
						            }

									// liì— í…ìŠ¤íŠ¸ì™€ img ì¶”ê°€
									listItem.appendChild(textNode);
									listItem.appendChild(img);

									listItem.style.fontWeight = "normal"; // li íƒœê·¸ì— normal ìŠ¤íƒ€ì¼ ì ìš©
									subList.appendChild(listItem);									
								});

								groupItem.appendChild(subList);
								parentProjectsList.appendChild(groupItem);
								
							
							});
						}
					})
					.catch(error => console.error('Error fetching grouped BBS data:', error));
				
			}
			
			);

			// ê²Œì‹œíŒëª… í´ë¦­ -> í—¤ë”ëª… ë³€ê²½
			document.addEventListener("DOMContentLoaded", function () {
				const parentProjectsList = document.querySelector("ul.parentsProjects");
				const customTitle = document.querySelector(".custom-title");
				const postListContainer = document.querySelector(".container-fluid.px-4");
				

				// ê²Œì‹œíŒ ì´ë¦„(li)ì„ í´ë¦­í–ˆì„ ë•Œ
				document.addEventListener("click", function (e) {
					const clicked = e.target;

					// ê²Œì‹œíŒ ì´ë¦„(li)ì˜ í…ìŠ¤íŠ¸ ë…¸ë“œë¥¼ í´ë¦­í–ˆì„ ë•Œë§Œ ì²˜ë¦¬
					if (clicked.tagName === "LI" && clicked.textContent.trim() !== "") {
						const bbsNm = clicked.childNodes[0].nodeValue.trim(); // ê²Œì‹œíŒ ì´ë¦„
						const bbsId = clicked.getAttribute("data-bbs-id"); // ê²Œì‹œíŒ ID (liì— data ì†ì„±ìœ¼ë¡œ ë„£ì–´ì•¼ í•¨)

						if (!bbsId) {
					        console.warn("bbsIdê°€ ì—†ìŠµë‹ˆë‹¤.");
					        return;
					      }

						// ì œëª© ë³€ê²½
						if (customTitle) {
							customTitle.textContent = bbsNm;
						}

						
						makList(bbsId)
						
						}
						
				});
				
				});

document.addEventListener("DOMContentLoaded", function () {
    const parentProjectsList = document.querySelector("ul.parentsProjects");

    parentProjectsList.addEventListener("click", function (e) {
        const clicked = e.target;

        if (clicked.tagName === "LI" && clicked.textContent.trim() !== "") {
            const bbsId = clicked.getAttribute("data-bbs-id"); // ê²Œì‹œíŒ ID
			const bbsNm = clicked.textContent.trim(); // ê²Œì‹œíŒ ì´ë¦„
			
            if (!bbsId) {
                console.warn("bbsIdê°€ ì—†ìŠµë‹ˆë‹¤.");
                return;
            }

            // ì„ íƒí•œ ê²Œì‹œíŒ IDë¥¼ localStorageì— ì €ì¥
            localStorage.setItem("selectedBbsId", bbsId);

            // articleList í˜ì´ì§€ë¡œ ì´ë™
            window.location.href = "/egowaeyo/article/articleList.do"+ `?bbsId=${encodeURIComponent(bbsId)}&bbsNm=${encodeURIComponent(bbsNm)}`;
        }
    });
});
			
			// ê²Œì‹œê¸€ ë°ì´í„°ë¥¼ ë Œë”ë§í•˜ëŠ” í•¨ìˆ˜
			function renderArticleDetail(article) {
			    document.querySelector("#article-title").textContent = article.nttSj;
			    document.querySelector("#article-content").textContent = article.nttCn;
			    document.querySelector("#article-author").textContent = article.frstRegisterNm;
			    document.querySelector("#article-date").textContent = article.frstRegisterPnttm;
			    document.querySelector(".custom-title").textContent = article.bbsNm;
			}
			
			// ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸°
			 document.addEventListener("DOMContentLoaded", function () {
				    // URLì—ì„œ bbsIdì™€ nttId íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
				    const urlParams = new URLSearchParams(window.location.search);
				    const bbsId = urlParams.get("bbsId");
				    const nttId = urlParams.get("nttId");
				    const fileBox = document.querySelector("#attached-file-box");

				    if (!bbsId || !nttId) {
				      console.error("bbsId ë˜ëŠ” nttIdê°€ URLì— ì—†ìŠµë‹ˆë‹¤.");
				      return;
				    }

				    // ì„œë²„ API í˜¸ì¶œ
				    fetch(`/egowaeyo/article/selectArticleDetail?bbsId=${bbsId}&nttId=${nttId}`)
				      .then(response => {
				        if (!response.ok) {
				          throw new Error("ì„œë²„ ì‘ë‹µì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.");
				        }
				    return response.json();
				    })
				    .then(data => {
				    if (data && Object.keys(data).length > 0) {
				    	 // ë°ì´í„°ë¥¼ HTML ìš”ì†Œì— ë Œë”ë§
		                document.querySelector("#article-title").textContent = data.nttSj || "ì œëª© ì—†ìŒ";
		                document.querySelector("#article-author").textContent = data.ntcrNm || "ì‘ì„±ì ì—†ìŒ";
		                document.querySelector("#article-date").textContent = data.frstRegisterPnttm?.split(" ")[0] || "ë‚ ì§œ ì—†ìŒ";
		                document.querySelector("#article-time").textContent = data.frstRegisterPnttm?.split(" ")[1] || "ì‹œê°„ ì—†ìŒ";
		                document.querySelector("#article-view").textContent = `ì¡°íšŒ ${data.inqireCo || 0}`;
		                document.querySelector(".custom-title").textContent = data.bbsNm || "ê²Œì‹œíŒ ì´ë¦„ ì—†ìŒ";
		             	
		                // nttCnì—ì„œ ì¤„ë°”ê¿ˆì„ <br>ë¡œ ë³€í™˜í•˜ê³  ì–‘ìª½ <p> íƒœê·¸ ì œê±°
		                const cleanedContent = data.nttCn.replace(/\n/g, "<br>").replace(/^<p>|<\/p>$/g, "");
		                document.querySelector("#article-content").innerHTML = cleanedContent;

				        } else {
				          console.error("ë°ì´í„°ê°€ ë¹„ì–´ ìˆìŠµë‹ˆë‹¤.");
				        }
				 // ì²¨ë¶€íŒŒì¼ì´ ìˆì„ ê²½ìš° í‘œì‹œ
				   if (data.bbsFileName && data.bbsFileOriName) {
    const fileLink = document.createElement("a");
    fileLink.href = `/egowaeyo/article/downloadFile?bbsFileName=${encodeURIComponent(data.bbsFileName)}&bbsFileOriName=${encodeURIComponent(data.bbsFileOriName)}`;
    fileLink.textContent = data.bbsFileOriName;
    fileLink.className = "text-primary";
    fileLink.download = "";

    fileBox.appendChild(fileLink);
}
				      })
				      .catch(error => console.error("Error fetching article detail:", error));
				    });
			
			
			// ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
			 document.addEventListener("DOMContentLoaded", function () {
				    const editButton = document.getElementById("editButton");
				    const deleteButton = document.getElementById("deleteButton");
				    const listButton = document.getElementById("listButton");

					// ìˆ˜ì • ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
				    editButton.addEventListener("click", function () {
				        const urlParams = new URLSearchParams(window.location.search);
				        const bbsId = urlParams.get("bbsId");
				        const nttId = urlParams.get("nttId");

				        if (!bbsId || !nttId) {
				            alert("ê²Œì‹œê¸€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				            return;
				        }

				        const targetUrl = `/egowaeyo/article/articleUpdate.do?bbsId=${bbsId}&nttId=${nttId}`;
				        console.log("Navigating to URL:", targetUrl); // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
				        window.location.href = targetUrl;
				    });
				    
				    // ì‚­ì œ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
				    deleteButton.addEventListener("click", function () {
				        const urlParams = new URLSearchParams(window.location.search);
				        const bbsId = urlParams.get("bbsId");
				        const nttId = urlParams.get("nttId");

				        if (!bbsId || !nttId) {
				            alert("ê²Œì‹œê¸€ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				            return;
				        }

				        const confirmDelete = confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?");
				        if (!confirmDelete) {
				            return;
				        }
				        fetch(`/egowaeyo/article/deleteArticle.do?bbsId=${bbsId}&nttId=${nttId}`, {
				            method: "DELETE",
				        })
				        .then(response => {
				            if (!response.ok) {
				                throw new Error("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
				            }
				            return response.json();
				        })
				        .then(data => {
				            if (data.success) {
				                alert("ê²Œì‹œê¸€ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.");
				                window.location.href = `/egowaeyo/article/articleList.do?bbsId=${bbsId}`;
				            } else {
				                alert("ê²Œì‹œê¸€ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
				            }
				        })
				        .catch(error => {
				            console.error("Error deleting article:", error);
				            alert("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");
				        });
					});
				    // ëª©ë¡ ë²„íŠ¼ í´ë¦­ ì´ë²¤íŠ¸
				    listButton.addEventListener("click", function () {
				        // URLì—ì„œ bbsId íŒŒë¼ë¯¸í„° ê°€ì ¸ì˜¤ê¸°
				        const urlParams = new URLSearchParams(window.location.search);
				        const bbsId = urlParams.get("bbsId");
				        const bbsNm = $('.custom-title').text().trim(); // ê²Œì‹œíŒ ì´ë¦„ ê°€ì ¸ì˜¤ê¸°'

				        if (!bbsId) {
				            alert("ìƒìœ„ ê²Œì‹œíŒ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
				            return;
				        }

				        // ìƒìœ„ ê²Œì‹œíŒ ë¦¬ìŠ¤íŠ¸ í˜ì´ì§€ë¡œ ì´ë™
				        const targetUrl = `/egowaeyo/article/articleList.do?bbsId=${bbsId}&bbsNm=${encodeURIComponent(bbsNm)}`;
				        console.log("Navigating to URL:", targetUrl); // ë””ë²„ê¹… ë¡œê·¸ ì¶”ê°€
				        window.location.href = targetUrl;
				    });
				});
			
			 
			 
			// ëŒ“ê¸€ ì¡°íšŒ
			 document.addEventListener("DOMContentLoaded", function () {
				    const bbsId = new URLSearchParams(window.location.search).get("bbsId");
				    const nttId = new URLSearchParams(window.location.search).get("nttId");

				    const pageSize = 10;
				    let currentPage = 1;

				    

				    function escapeJs(str) {
				    	  return (str || '')
				    	    .replace(/\\/g, '\\\\')
				    	    .replace(/`/g, '\\`')
				    	    .replace(/\$/g, '\\$')
				    	    .replace(/'/g, "\\'")
				    	    .replace(/\n/g, '\\n')
				    	    .replace(/\r/g, '');
				    	}
				    	function escapeHtml(str) {
				    	  return (str || '')
				    	    .replace(/&/g, '&amp;')
				    	    .replace(/</g, '&lt;')
				    	    .replace(/>/g, '&gt;')
				    	    .replace(/"/g, '&quot;')
				    	    .replace(/'/g, '&#39;');
				    	}
				    	function fetchComments(page = 1) {
				    		  currentPage = page;
				    		  const subPageIndex = page - 1;

				    		  fetch(`/egowaeyo/comment/list?bbsId=${bbsId}&nttId=${nttId}&subPageIndex=${subPageIndex}&subRecordCountPerPage=${pageSize}`)
				    		    .then(response => {
				    		      if (!response.ok) throw new Error("ì„œë²„ ì—ëŸ¬");
				    		      return response.json();
				    		    })
				    		    .then(data => {
				    		      const commentList = document.getElementById("commentList");
				    		      commentList.innerHTML = "";

				    		      if (data.resultList && data.resultList.length > 0) {
				    		        data.resultList.forEach(comment => {
				    		          const div = document.createElement("div");
				    		          div.id = `comment-${comment.commentNo}`;
				    		          div.className = "comment-item mb-3";

				    		          div.innerHTML = `
				    		            <div class="d-flex align-items-start">
				    		              <div class="avatar me-3"></div>
				    		              <div>
				    		                <p class="mb-0" style="font-size: 15px; color: #444;">${escapeHtml(comment.wrterNm)}</p>
				    		                <div style="font-size: 12px; color: #888;">
				    		                  <span>${comment.frstRegisterPnttm.split(" ")[0]}</span>
				    		                  <span>${comment.frstRegisterPnttm.split(" ")[1]}</span>
				    		                </div>
				    		                <p class="comment-text mt-2">${escapeHtml(comment.commentCn)}</p>
				    		                <button class="btn btn-sm btn-dark me-2"
				    		                  onclick="editComment('${comment.commentNo}', \`${escapeJs(comment.commentCn)}\`)">
				    		                  ìˆ˜ì •
				    		                </button>
				    		                <button class="btn btn-sm btn-danger"
				    		                  onclick="deleteComment('${comment.commentNo}')">
				    		                  ì‚­ì œ
				    		                </button>
				    		              </div>
				    		            </div>`;

				    		          commentList.appendChild(div);
				    		        });
				    		      } else {
				    		        commentList.innerHTML = "<p>ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>";
				    		      }

				    		      renderPagination(data.resultCnt, currentPage);
				    		    })
				    		    .catch(error => {
				    		      console.error("Error fetching comments:", error);
				    		      alert("ëŒ“ê¸€ ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
				    		    });
				    		}
				    
				    // í˜ì´ì§€ë„¤ì´ì…˜ ë Œë”ë§
				    function renderPagination(totalCount, currentPage) {
				        const totalPages = Math.ceil(totalCount / pageSize);
				        const pagination = document.querySelector("#comment-pagination .pagination");

				        let html = "";

				        // ì´ì „ ë²„íŠ¼
				        html += `<li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
				                    <a class="page-link" href="#" onclick="fetchComments(${currentPage - 1}); return false;">ì´ì „</a>
				                </li>`;

				        // í˜ì´ì§€ ë²ˆí˜¸ ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ
				        let start = Math.max(1, currentPage - 2);
				        let end = Math.min(totalPages, start + 4);
				        if (end - start < 4) start = Math.max(1, end - 4);

				        for (let i = start; i <= end; i++) {
				            html += `<li class="page-item ${i === currentPage ? 'active' : ''}">
				                        <a class="page-link" href="#" onclick="fetchComments(${i}); return false;">${i}</a>
				                     </li>`;
				        }

				        // ë‹¤ìŒ ë²„íŠ¼
				        html += `<li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
				                    <a class="page-link" href="#" onclick="fetchComments(${currentPage + 1}); return false;">ë‹¤ìŒ</a>
				                </li>`;

				        pagination.innerHTML = html;
				    }

				    // ì „ì—­ ì ‘ê·¼ì„ ìœ„í•´ windowì— ë“±ë¡
				    window.fetchComments = fetchComments;

				    // ì´ˆê¸° í˜¸ì¶œ
				    fetchComments();
				

				    // ëŒ“ê¸€ ë“±ë¡
				    document.getElementById("commentSubmitButton").addEventListener("click", function () {
				        const commentContent = document.getElementById("commentContent").value;

				        if (!commentContent.trim()) {
				            alert("ëŒ“ê¸€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
				            return;
				        }

				        fetch("/egowaeyo/comment/add", {
				            method: "POST",
				            headers: { "Content-Type": "application/json" },
				            body: JSON.stringify({ bbsId, nttId, commentCn: commentContent })
				        })
				            .then(response =>  {
				            	if (!response.ok) {
				                return response.text().then(text => {
				                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status} - ${text}`);
				                });
				            }
				            return response.text();
				        })
				            .then(message => {
				                alert(message);
				                fetchComments(); // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
				                document.getElementById("commentContent").value = ""; // ì…ë ¥ í•„ë“œ ì´ˆê¸°í™”
				            })
				            .catch(error => {
				                console.error("Error adding comment:", error);
				                alert("ëŒ“ê¸€ ë“±ë¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: " + error.message);
				            });
				    });

				 // ëŒ“ê¸€ ìˆ˜ì • í•¨ìˆ˜ (textareaë¡œ ì¸ë¼ì¸ ìˆ˜ì •)
				    window.editComment = function (commentNo, commentCn) {
  const commentDiv = document.getElementById(`comment-${commentNo}`);
  if (!commentDiv) return;

  // ê¸°ì¡´ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê¸°
  const p = commentDiv.querySelector('.comment-text');
  if (p) p.style.display = 'none';

  // ì´ë¯¸ í¸ì§‘ ì¤‘ì´ë©´ ë¦¬í„´
  if (commentDiv.querySelector('textarea')) return;

  // textarea + ë²„íŠ¼ë“¤ì„ ê°ìŒ€ div ìƒì„±
  const editContainer = document.createElement('div');
  editContainer.className = 'edit-container mt-2';

  const textarea = document.createElement('textarea');
  textarea.className = 'form-control mb-2';
  textarea.value = commentCn;
  textarea.rows = 3;

  const btnGroup = document.createElement('div');
  btnGroup.className = 'btn-group btn-group-sm';

  const saveBtn = document.createElement('button');
  saveBtn.className = 'btn btn-primary';
  saveBtn.textContent = 'ì €ì¥';
  saveBtn.onclick = function () {
    const newContent = textarea.value.trim();
    if (!newContent) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");

    fetch("/egowaeyo/comment/update", {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ commentNo, commentCn: newContent })
    })
      .then(response => response.text())
      .then(message => {
        alert(message);
        fetchComments(); // ì „ì²´ ë‹¤ì‹œ ë¶ˆëŸ¬ì˜´
      })
      .catch(error => {
        console.error("ëŒ“ê¸€ ìˆ˜ì • ì˜¤ë¥˜:", error);
        alert("ëŒ“ê¸€ ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");
      });
  };

  const cancelBtn = document.createElement('button');
  cancelBtn.className = 'btn btn-secondary';
  cancelBtn.textContent = 'ì·¨ì†Œ';
  cancelBtn.onclick = () => {
    editContainer.remove();
    if (p) p.style.display = 'block';
  };

  btnGroup.appendChild(saveBtn);
  btnGroup.appendChild(cancelBtn);

  editContainer.appendChild(textarea);
  editContainer.appendChild(btnGroup);

  commentDiv.appendChild(editContainer);
};

				    // ëŒ“ê¸€ ì‚­ì œ
				    window.deleteComment = function (commentNo) {
				        if (!confirm("ì •ë§ë¡œ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;

				        fetch("/egowaeyo/comment/delete", {
				            method: "DELETE",
				            headers: { "Content-Type": "application/json" },
				            body: JSON.stringify({ commentNo })
				        })
				            .then(response => response.text())
				            .then(message => {
				                alert(message);
				                fetchComments(); // ëŒ“ê¸€ ëª©ë¡ ê°±ì‹ 
				            })
				            .catch(error => console.error("Error deleting comment:", error));
				    };

				    // ì´ˆê¸° ëŒ“ê¸€ ëª©ë¡ ì¡°íšŒ
				    fetchComments();
				});
			
		</script>
		<div>
</main>

</html>
<?xml version="1.0" encoding="UTF-8"?><!-- 수정일 수정자 수정내용 ========= ======= 
	================================================= 2020.07.14 신용호 게시판마스터 페이징처리 
	오류수정 (180. 게시판관리) -->
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper
	namespace="egovframework.com.egowaeyo.bbsMaster.mapper.BbsMasterMapper">


	<resultMap id="boardMasterDetail"
		type="egovframework.com.egowaeyo.bbsMaster.VO.BoardMasterVO">
		<result property="bbsId" column="BBS_ID" />
		<result property="bbsTyCode" column="BBS_TY_CODE" />

		<result property="bbsNm" column="BBS_NM" />
		<result property="bbsIntrcn" column="BBS_INTRCN" />
		<result property="replyPosblAt" column="REPLY_POSBL_AT" />
		<result property="fileAtchPosblAt" column="FILE_ATCH_POSBL_AT" />


		<result property="tmplatId" column="TMPLAT_ID" />
		<result property="frstRegisterId" column="FRST_REGISTER_ID" />
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" />
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" />
		<result property="bbsTyCodeNm" column="BBS_TY_CODE_NM" />

		<result property="tmplatNm" column="TMPLAT_NM" />
		<result property="authFlag" column="AUTH_FLAG" />
		<result property="tmplatCours" column="TMPLAT_COURS" />
	</resultMap>

	<!-- 사이드바 -->
	<select id="selectGroupedBbsData" resultType="map">
		SELECT
		NVL(A.CODE_NM, 'UNKNOWN') AS codeNm,
		NVL(B.BBS_NM, 'UNKNOWN') AS bbsNm
		FROM
		COMTCCMMNDETAILCODE A
		LEFT JOIN
		COMTNBBSMASTER B
		ON
		A.CODE =
		B.BBS_TY_CODE
		WHERE
		A.CODE LIKE 'BBST%'
	</select>

	<!-- 상위 게시판 목록 조회(공통코드 조회) -->
	<select id="selectCombbs">
		SELECT code_nm FROM COMTCCMMNDETAILCODE
		WHERE CODE
		LIKE 'BBST%'
	</select>

	<!-- 부서, 사원 불러오기 -->
	<select id="selectDeptEmp" resultMap="deptEmpResultMap">
		SELECT o.orgnzt_id, o.orgnzt_nm, e.user_nm, e.ofcps_nm
		FROM COMTNORGNZTINFO o JOIN COMTNEMPLYRINFO e ON
		o.orgnzt_id=e.orgnzt_id
	</select>

	<resultMap id="deptEmpResultMap"
		type="egovframework.com.egowaeyo.bbsMaster.VO.BoardMasterVO">
		<result property="orgnztId" column="orgnzt_id" />
		<result property="orgnztNm" column="orgnzt_nm" />
		<result property="userNm" column="user_nm" />
		<result property="ofcpsNm" column="ofcps_nm" />
	</resultMap>

	<!-- 게시판 추가 -->
	<insert id="insertBBSMaster"
		parameterType="egovframework.com.egowaeyo.bbsMaster.VO.BoardMasterVO">
		INSERT INTO COMTNBBSMASTER(BBS_ID, BBS_NM, BBS_TY_CODE,
		FILE_ATCH_POSBL_AT, ATCH_POSBL_FILE_NUMBER, USE_AT,
		FRST_REGISTER_ID, FRST_REGIST_PNTTM)
		VALUES(#{bbsId}, #{bbsNm}, #{bbsTyCode},
		'Y', 3, #{useAt},
		#{frstRegisterId}, SYSDATE)
	</insert>
	
	<select id="selectCodeByCodeNm" parameterType="String" resultType="String">
    SELECT CODE, CODE_NM
    FROM COMTCCMMNDETAILCODE
    WHERE CODE LIKE 'BBST%' AND CODE_NM = #{codeNm}
</select>

	<!-- MAX공통코드 조회(상위 게시판) -->
	<select id="getMaxBbsTyCode" resultType="string">
		SELECT MAX(CODE)
		FROM
		COMTCCMMNDETAILCODE
		WHERE CODE LIKE 'BBST%'
	</select>

	<!-- 공통코드 추가(상위 게시판) -->
	<insert id="insertCommonDetailCode" parameterType="map">
		INSERT INTO
		COMTCCMMNDETAILCODE (CODE_ID, CODE, CODE_NM, USE_AT,
		FRST_REGIST_PNTTM, FRST_REGISTER_ID)
		VALUES ('COM101', #{code}, #{codeNm}, #{useAt}, SYSDATE,#{frstRegisterId})
	</insert>

	<!-- 권한 설정(게시판 추가) -->
	<insert id="insertBBSMasterAuth"
		parameterType="egovframework.com.egowaeyo.bbsMaster.VO.BoardMasterVO">
		INSERT INTO COMTNBBSAUTHOR(EMPLYR_ID, BBS_ID,
		AUTHOR_CODE)
		VALUES
		( #{emplyrId}, #{bbsId}, #{authorCode} )
	</insert>

</mapper>
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="egovframework.com.egowaeyo.attendance.mapper.AttendanceMapper">
	<select id="getAttend" resultType="AttendVO" parameterType="AttendVO">
		SELECT
				CHECKDATE,
				EMPLYR_ID,
				CHECKIN,
				CHECKOUT,
				trans(INSTATE,'COM103') INSTATE,
				trans(OUTSTATE,'COM103') OUTSTATE,
				OVER_CHECK_TIME,
				CHECK_TIME,
				MODSTATE				
		FROM ATTENDANCE
		<where>
			<if test="emplyrId != null and emplyrId != ''" >
			  	EMPLYR_ID = #{emplyrId}
			</if>
			<if test="startDate != null and startDate != '' and endDate != null and endDate !=''" >
				AND CHECKDATE BETWEEN #{startDate} AND #{endDate}
			</if> 
		</where>
		ORDER BY CHECKDATE
	</select>
	 <select id="callAttendanceEditProcedure" parameterType="EditAttendVO" 
            statementType="CALLABLE" resultType="EditAttendVO">
        {CALL PROC_ATTENDANCE_APPROVAL_EDIT(
            #{editIn, mode=IN, jdbcType=CHAR},
            #{editOut, mode=IN, jdbcType=CHAR},
            #{checkdate, mode=IN, jdbcType=CHAR},
            #{emplyrId, mode=IN, jdbcType=VARCHAR},
            #{checkin, mode=IN, jdbcType=CHAR},
            #{checkout, mode=IN, jdbcType=CHAR},
            #{result, mode=OUT, jdbcType=VARCHAR},
            #{message, mode=OUT, jdbcType=VARCHAR}
        )}
    </select>
    <select id="getEditList"  parameterType="EditAttendVO" resultType="EditAttendVO">
    	

    SELECT
        EDIT_CD      AS editCd,
        EDIT_IN      AS editIn,
        EDIT_OUT     AS editOut,
        EDIT_RS      AS editRs,
        CREATE_DT    AS createDt,
        EDIT_DT      AS editDt,
        EDITER       AS editer,
        SUPERVISOR   AS supervisor,
        SUP_DT       AS supDt,
        CHECKDATE    AS checkdate,
        EMPLYR_ID    AS emplyrId,
        CHECKIN      AS checkin,
        CHECKOUT     AS checkout
    FROM EDITAPPROVAL
    <where>
        <!-- 신청자, 근태일자 등 일반 필터 -->
        <if test="emplyrId != null and emplyrId != ''">
            EMPLYR_ID = #{emplyrId}
        </if>
        <if test="checkdate != null and checkdate != ''">
            <if test="emplyrId != null and emplyrId != ''"> AND </if>
           CHECKDATE BETWEEN #{startDate} AND #{endDate}
        </if>

        <!-- editer 존재 여부 필터 -->
    </where>
    ORDER BY CREATE_DT,EDITER DESC
</select>
 
	
</mapper>